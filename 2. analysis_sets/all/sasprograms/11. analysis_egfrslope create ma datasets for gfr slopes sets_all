%let path1=d:\userdata\Shared\CKD_Endpts\CKD-EPI CT\Data\TRIALNAME;
%let path2=d:\userdata\Shared\CKD_Endpts\CKD-EPI CT\0_Master_SAS_R_programs\1 TxtEffects;

libname Master "&path1";
libname SASdata  "&path1\analysis_sets\all\datasets";
libname Exports "&path1\analysis_sets\all\Exports";
 
options validvarname=v7 nodate center nonumber replace xsync noxwait nofmterr ls=96 mautosource 
sasautos=("&path2\macros");
data ntassign01;
 set SASdata.studies;
run;
proc sort data=ntassign01 out=ntassign11 nodupkey;
 by study new_id;
run;
data ntassign11a;
 set ntassign11;
 if t_assign=0;
run;
data ntassign11b;
 set ntassign11;
 if t_assign=1;
run;
proc sql; 
  create table txt0 as
  select study,count(*) as npatients0
  from ntassign11a
  group by study;
quit;
proc sql; 
  create table txt1 as
  select study,count(*) as npatients1
  from ntassign11b
  group by study;
quit;
proc sort data=txt0;
 by study;
run;
proc sort data=txt1;
 by study;
run;
data txt01;
 merge txt0 txt1;
 by study;
run;
data gfrlopes_ma;
 set exports.nfirstmodelinseqperstudyt99;
 if cs_reason ne "NOTE: GCONV convergence criterion satisfied." then delete;
run;
data zacute;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="zAcute";
 estimate=zbeta11_beta12_est;
 se=zbeta11_beta12_se;
 estimate1=zbeta11_est;
 se1=zbeta11_se;
 estimate2=zbeta12_est;
 se2=zbeta12_se;
 parameternumber=-1;
 keep study parameter parameternumber estimate se estimate1 se1 estimate2 se2 zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt 
      pooled pooled_fmt intervention intervention_fmt intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data acute;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Acute";
 estimate=beta11_beta12_est;
 se=beta11_beta12_se;
 estimate1=beta11_est;
 se1=beta11_se;
 estimate2=beta12_est;
 se2=beta12_se;
 parameternumber=0;
 keep study parameter parameternumber estimate se estimate1 se1 estimate2 se2 zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt 
      pooled pooled_fmt intervention intervention_fmt intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data chronic;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Chronic";
 estimate=beta31_beta32_est;
 se=beta31_beta32_se;
 estimate1=beta31_est;
 se1=beta31_se;
 estimate2=beta32_est;
 se2=beta32_se;
 parameternumber=1;
 keep study parameter parameternumber estimate se estimate1 se1 estimate2 se2 zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt 
      pooled pooled_fmt intervention intervention_fmt intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data total_1y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Total 1y";
 estimate=beta41_42_1y_est;
 se=beta41_42_1y_se;
 estimate1=beta41_1y_est;
 se1=beta41_1y_se;
 estimate2=beta42_1y_est;
 se2=beta42_1y_se;
 parameternumber=2;
 keep study parameter parameternumber estimate se estimate1 se1 estimate2 se2 zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt
      pooled pooled_fmt intervention intervention_fmt intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data total_2y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Total 2y";
 estimate=beta41_42_2y_est;
 se=beta41_42_2y_se;
 estimate1=beta41_2y_est;
 se1=beta41_2y_se;
 estimate2=beta42_2y_est;
 se2=beta42_2y_se;
 parameternumber=3;
 keep study parameter parameternumber estimate se estimate1 se1 estimate2 se2 zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt 
      pooled pooled_fmt intervention intervention_fmt intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data total_3y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Total 3y";
 estimate=beta41_42_3y_est;
 se=beta41_42_3y_se;
 estimate1=beta41_3y_est;
 se1=beta41_3y_se;
 estimate2=beta42_3y_est;
 se2=beta42_3y_se;
 parameternumber=4;
 keep study parameter parameternumber estimate se estimate1 se1 estimate2 se2 zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt
      pooled pooled_fmt intervention intervention_fmt intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data total_4y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Total 4y";
 estimate=beta41_42_4y_est;
 se=beta41_42_4y_se;
 estimate1=beta41_4y_est;
 se1=beta41_4y_se;
 estimate2=beta42_4y_est;
 se2=beta42_4y_se;
 parameternumber=5;
 keep study parameter parameternumber estimate se estimate1 se1 estimate2 se2 zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt 
      pooled pooled_fmt intervention intervention_fmt intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data chronic_t1y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Chronic-Total 1y";
 estimate=chronic_t1y_est;
 se=chronic_t1y_se;
 parameternumber=6;
 keep study parameter parameternumber estimate se zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt pooled pooled_fmt intervention intervention_fmt
      intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data chronic_t2y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Chronic-Total 2y";
 estimate=chronic_t2y_est;
 se=chronic_t2y_se;
 parameternumber=7;
 keep study parameter parameternumber estimate se zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt pooled pooled_fmt intervention intervention_fmt
      intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data chronic_t3y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Chronic-Total 3y";
 estimate=chronic_t3y_est;
 se=chronic_t3y_se;
 parameternumber=8;
 keep study parameter parameternumber estimate se zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt pooled pooled_fmt intervention intervention_fmt
      intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data chronic_t4y;
 length parameter $16. parameternumber 8.;
 set gfrlopes_ma;
 parameter="Chronic-Total 4y";
 estimate=chronic_t4y_est;
 se=chronic_t4y_se;
 parameternumber=9;
 keep study parameter parameternumber estimate se zallrx allrx allrxname allrxname1 study_code npatients nevents region region_fmt pooled pooled_fmt intervention intervention_fmt
      intervention_abrev disease disease_fmt disease2 disease2_fmt;
run;
data slopes_t99_ma;
 set zacute acute chronic total_1y total_2y total_3y total_4y chronic_t1y chronic_t2y chronic_t3y chronic_t4y;
run;
proc sort data=slopes_t99_ma;
 by study;
run;
proc sort data=txt01;
 by study;
run;
data slopes_t99_all_ma;
 merge slopes_t99_ma txt01;
 by study;
run;
proc sort data=slopes_t99_all_ma;
 by parameternumber zallrx;
run;

data Exports.slopes_t99_all_ma;
 set slopes_t99_all_ma;
run;
%zexportcsv(slopes_t99_all_ma,slopes_t99_all_ma,&path1\analysis_sets\all\Exports);
